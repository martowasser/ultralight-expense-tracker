# Ralph Progress Log
Started: Wed Jan 21 00:10:20 -03 2026

## Codebase Patterns
- Uses Next.js App Router with server components and server actions
- Prisma ORM with PostgreSQL, uses PrismaPg adapter for runtime
- UI follows minimal design (no component library), uses Tailwind CSS with custom CSS variables
- Server actions return `{ success: boolean; error?: string }` for mutations
- Always check `session?.user?.id` in server actions for auth
- Use `router.refresh()` after mutations to refresh server components
- Seed files should be excluded from tsconfig to avoid compilation issues
- Use `npx tsx` for running TypeScript scripts like seeds
- In Next.js 16+, "use server" files can ONLY export async functions - constants must go in separate files (e.g., constants.ts)
---

## 2026-01-21 - US-INV-032
- What was implemented: Database schema for investments module
- Files changed:
  - prisma/schema.prisma - Added Asset, Investment, Dividend, PortfolioSnapshot, PriceCache models
  - prisma/seed.ts - Created seed script for 30 pre-populated assets
  - package.json - Added db:seed script and prisma seed config
  - tsconfig.json - Excluded seed.ts from compilation
- **Learnings for future iterations:**
  - Prisma client is generated to src/generated/prisma/client
  - Currency enum expanded to 10 currencies (ARS, USD, EUR, GBP, JPY, CAD, AUD, CHF, CNY, BRL)
  - Asset precision: 6 for crypto, 2 for stocks/ETFs
  - UserSettings model exists and was extended with displayCurrency and preferredCurrencies
  - Investment model supports lot tracking with separate purchases of same asset
  - PriceCache uses symbol as primary key for efficient lookups
---

## 2026-01-21 - US-INV-001
- What was implemented: Browse Asset Library feature
- Files changed:
  - src/app/investments/actions.ts - Server actions for getAssets (with search/filter) and getAssetById
  - src/app/investments/page.tsx - Main investments page (server component)
  - src/components/AssetLibrarySection.tsx - Client component with search/filter controls
  - src/components/AssetLibraryList.tsx - Display component for assets grouped by type
  - src/components/Header.tsx - Added "investments" link to navigation
- **Learnings for future iterations:**
  - Investment module routes are at /investments
  - Assets are fetched with both global (isGlobal: true) and user-specific (userId) options
  - Type filter uses AssetType enum: CRYPTO, STOCK, ETF
  - Search is case-insensitive and matches both symbol and name
  - Debounced search (300ms) for better UX
  - Assets grouped by type in display, with type order: CRYPTO, STOCK, ETF
---

## 2026-01-21 - US-INV-002
- What was implemented: Add Investment feature
- Files changed:
  - src/app/investments/actions.ts - Added createInvestment action with validation
  - src/app/investments/constants.ts - Created for PLATFORMS and CURRENCIES constants (can't export from "use server" files)
  - src/components/AddInvestmentModal.tsx - Modal component for creating investments
  - src/components/AssetLibrarySection.tsx - Added "add investment" button to open modal
- **Learnings for future iterations:**
  - Next.js 16+ "use server" files can only export async functions - constants must be in separate files
  - Investment form includes: asset selection (with search), quantity, price, currency, date, platform, notes
  - Quantity validation respects asset precision (6 for crypto, 2 for stocks)
  - Total cost is calculated and displayed before saving
  - Common platforms provided in dropdown with "Other" option for custom entry
  - All 10 currencies are supported for investment purchases
---
