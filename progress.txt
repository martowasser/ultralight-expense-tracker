# Ralph Progress Log
Started: Fri Jan 16 23:20:34 -03 2026
---

## Codebase Patterns
- Next.js 16 with App Router (src/app directory)
- Tailwind CSS 4 using @tailwindcss/postcss plugin
- ESLint 9 flat config (eslint.config.mjs) - use typescript-eslint for TS/TSX linting
- `next lint` command not available in Next.js 16, use `eslint` directly
- Prisma 7 requires driver adapter (e.g., @prisma/adapter-pg) - cannot use PrismaClient() without adapter
- Prisma client generated to src/generated/prisma/client.ts - import from "@/generated/prisma/client"
- Use singleton pattern for PrismaClient in src/lib/prisma.ts
- NextAuth v5 configured in src/auth.ts - use { auth, signIn, signOut } exports
- PostgreSQL running in Docker on port 5434 (container: expense-tracker-postgres)
- In Next.js 16, searchParams is a Promise - use `searchParams: Promise<{ key?: string }>` and `await searchParams`
- Server actions in src/app/dashboard/actions.ts - export types for UI components
- Prisma Decimal fields need .toString() conversion before returning from server actions

---

## 2026-01-16 - US-001
- What was implemented:
  - Verified Next.js 16 project with App Router structure
  - Configured ESLint 9 with flat config format (eslint.config.mjs)
  - Added .gitignore for node_modules, .next, and other build artifacts
  - Updated package.json lint script to use eslint directly
- Files changed:
  - eslint.config.mjs (created)
  - .gitignore (created)
  - package.json (lint script updated)
  - prd.json (marked US-001 as passes: true)
- **Learnings for future iterations:**
  - Next.js 16 does not include `next lint` command - must use eslint directly
  - ESLint 9 requires flat config format (eslint.config.mjs), not .eslintrc.json
  - Use typescript-eslint for TypeScript linting in ESLint 9 flat config
  - eslint-config-next has compatibility issues with FlatCompat in ESLint 9
---

## 2026-01-16 - US-002
- What was implemented:
  - Installed Prisma CLI and @prisma/client
  - Initialized Prisma with PostgreSQL provider
  - Added User model placeholder with id, email, createdAt, updatedAt fields
  - Configured Prisma 7 with @prisma/adapter-pg driver adapter
  - Created src/lib/prisma.ts with singleton pattern for PrismaClient
  - Added src/generated/prisma to .gitignore
- Files changed:
  - package.json (added prisma, @prisma/client, @prisma/adapter-pg, pg, dotenv, @types/pg)
  - package-lock.json (updated)
  - prisma/schema.prisma (created with User model)
  - prisma.config.ts (created)
  - src/lib/prisma.ts (created)
  - .gitignore (added /src/generated/prisma)
  - prd.json (marked US-002 as passes: true)
- **Learnings for future iterations:**
  - Prisma 7 has breaking change: PrismaClient now requires adapter or accelerateUrl
  - For PostgreSQL, use @prisma/adapter-pg with PrismaPg class
  - prisma generate outputs to src/generated/prisma/client.ts (not index.ts)
  - The generated client uses "prisma-client" provider, not "prisma-client-js"
---

## 2026-01-17 - US-003
- What was implemented:
  - Installed NextAuth.js v5 beta and bcryptjs for password hashing
  - Updated User model in Prisma schema with password field (String)
  - Ran Prisma migration successfully (add_user_password)
  - Created src/auth.ts with NextAuth configuration using Credentials provider
  - Created src/app/api/auth/[...nextauth]/route.ts for API route handler
  - Created src/types/next-auth.d.ts for TypeScript type extensions
  - All typecheck and lint checks pass
- Files changed:
  - package.json (added next-auth, bcryptjs, @types/bcryptjs)
  - package-lock.json (updated)
  - prisma/schema.prisma (added password field to User model)
  - prisma/migrations/20260117023613_add_user_password/ (created)
  - src/auth.ts (created - NextAuth configuration)
  - src/app/api/auth/[...nextauth]/route.ts (created)
  - src/types/next-auth.d.ts (created)
  - prd.json (marked US-003 as passes: true)
- **Learnings for future iterations:**
  - NextAuth v5 uses a simplified API: export { handlers, signIn, signOut, auth } from NextAuth()
  - Credentials provider authorize function should return null for invalid credentials (not throw)
  - Use bcryptjs (not bcrypt) for better Node.js compatibility
  - NextAuth v5 route handler at src/app/api/auth/[...nextauth]/route.ts exports { GET, POST } from handlers
  - Custom session fields require extending next-auth types in src/types/next-auth.d.ts
---

## 2026-01-17 - US-004
- What was implemented:
  - Created login page at /login with email and password fields
  - Used "use client" directive for client-side form handling
  - Implemented signIn from next-auth/react with redirect: false
  - Added error state to display "Invalid email or password" message
  - Configured redirect to /dashboard on successful login
  - Styled with Tailwind CSS matching existing patterns
- Files changed:
  - src/app/login/page.tsx (created)
  - prd.json (marked US-004 as passes: true)
- **Learnings for future iterations:**
  - For client-side form handling in Next.js App Router, use "use client" directive
  - Use signIn from "next-auth/react" (not from auth.ts) for client components
  - Set redirect: false in signIn options to handle errors manually
  - Check result?.error to detect authentication failures
---

## 2026-01-17 - US-005
- What was implemented:
  - Created registration page at /register with email, password, and confirm password fields
  - Added client-side validation (all fields required, passwords must match, min 6 chars)
  - Created API route at /api/auth/register that creates users in database
  - API validates email format, password length, and checks for existing users
  - Passwords are hashed with bcryptjs before storing
  - Redirect to /login after successful registration
  - Added link to login page for existing users
- Files changed:
  - src/app/register/page.tsx (created)
  - src/app/api/auth/register/route.ts (created)
  - prd.json (marked US-005 as passes: true)
- **Learnings for future iterations:**
  - Registration API route pattern: validate -> check existing user -> hash password -> create user
  - Use fetch() with JSON body to call API routes from client components
  - Both client and server-side validation should be performed for security
---

## 2026-01-17 - US-006
- What was implemented:
  - Created dashboard page at /dashboard that requires authentication
  - Dashboard uses server-side auth() to check session and redirects to /login if not authenticated
  - Created Header component (src/components/Header.tsx) showing user email and logout button
  - Logout button calls signOut from next-auth/react with redirect to /login
  - Dashboard is a server component, Header is a client component (for signOut interaction)
- Files changed:
  - src/app/dashboard/page.tsx (created)
  - src/components/Header.tsx (created)
  - prd.json (marked US-006 as passes: true)
- **Learnings for future iterations:**
  - Use auth() from src/auth.ts for server-side session checks in server components
  - Use redirect() from next/navigation for server-side redirects
  - For logout, use signOut from "next-auth/react" in client components
  - Pattern: Server component checks auth and passes user data to client components as props
---

## 2026-01-17 - US-007
- What was implemented:
  - Added Expense model with: id, userId, name (String), amount (Decimal), dueDay (Int), createdAt, updatedAt
  - Added MonthlyExpense model with: id, expenseId, userId, month (String YYYY-MM), amount (Decimal), isPaid (Boolean default false), createdAt, updatedAt
  - Set up relations: User hasMany Expense, User hasMany MonthlyExpense, Expense hasMany MonthlyExpense
  - Added onDelete: Cascade for foreign key relations to clean up orphan records
  - Added indexes for common queries: userId on Expense, (userId, month) and (expenseId, month) on MonthlyExpense
  - Added unique constraint on (expenseId, month) to prevent duplicate monthly entries
  - Migration ran successfully (20260117024526_add_expense_models)
- Files changed:
  - prisma/schema.prisma (added Expense and MonthlyExpense models, added relations to User)
  - prisma/migrations/20260117024526_add_expense_models/ (created)
  - prd.json (marked US-007 as passes: true)
- **Learnings for future iterations:**
  - Use Decimal type for monetary values in Prisma
  - Add @@index for columns commonly used in WHERE clauses
  - Use @@unique for composite constraints (e.g., one MonthlyExpense per expense per month)
  - onDelete: Cascade ensures related records are deleted when parent is deleted
---

## 2026-01-17 - US-008
- What was implemented:
  - Updated dashboard page to show current month and year (e.g., 'January 2026')
  - Added URL query param support (?month=2026-01) for month selection
  - Dashboard auto-redirects to include month param if missing or invalid
  - Added helper functions: getCurrentMonth(), formatMonthDisplay(), isValidMonthFormat()
  - In Next.js 16, searchParams is a Promise that must be awaited
- Files changed:
  - src/app/dashboard/page.tsx (updated with month header logic)
  - prd.json (marked US-008 as passes: true)
- **Learnings for future iterations:**
  - In Next.js 16 App Router, searchParams prop is a Promise<{ [key]: string }> - must await it
  - Use redirect() to ensure URL always reflects state (month param always present)
  - toLocaleDateString("en-US", { month: "long", year: "numeric" }) formats month nicely
---

## 2026-01-17 - US-009
- What was implemented:
  - Created MonthNavigation client component with Previous and Next buttons
  - Buttons flank the month header in the dashboard
  - Clicking Previous/Next updates URL query param to navigate months
  - Used router.push() from next/navigation for client-side navigation
  - Added helper functions getPreviousMonth() and getNextMonth() for date math
- Files changed:
  - src/components/MonthNavigation.tsx (created)
  - src/app/dashboard/page.tsx (integrated MonthNavigation component)
  - prd.json (marked US-009 as passes: true)
- **Learnings for future iterations:**
  - For client-side navigation in App Router, use useRouter() from "next/navigation" with router.push()
  - Date manipulation for months: create Date, setMonth(+/-1), extract year/month from result
  - Pattern: Server component fetches data, client component handles navigation/interaction
---

## 2026-01-17 - US-010
- What was implemented:
  - Created server action in src/app/dashboard/actions.ts to fetch MonthlyExpense records
  - Server action filters by userId and month, orders by expense.dueDay ascending
  - Created ExpenseList component (src/components/ExpenseList.tsx) displaying name, amount, due day, paid status
  - Added empty state message when no expenses exist for the selected month
  - Integrated ExpenseList into dashboard page, passing fetched expenses
  - Amount displayed with proper $ formatting and 2 decimal places
  - Paid status shows as color-coded badges (green for Paid, yellow for Pending)
- Files changed:
  - src/app/dashboard/actions.ts (created - server action for fetching expenses)
  - src/components/ExpenseList.tsx (created - expense list component)
  - src/app/dashboard/page.tsx (updated to use ExpenseList)
  - prd.json (marked US-010 as passes: true)
- **Learnings for future iterations:**
  - Use "use server" directive for server actions in separate files
  - Prisma Decimal type needs .toString() conversion for serialization to client
  - Export types from actions.ts for use in UI components (MonthlyExpenseWithExpense)
  - Pattern: Server action fetches data with auth check, returns serializable data to components
---
